---
// pages/servicos/[slug].astro - Vers√£o SSR Completa

import { Image } from 'astro:assets';
import MainLayout from '../../layouts/mainLayout.astro';
import Heading from '../../components/typograph/Heading.astro';
import Paragraph from '../../components/typograph/Paragraph.astro';
import Button from '../../components/buttons/mainButton.astro';
import { getServiceBySlug, type ServiceData } from '../../data/servicesData';

// NO SSR, N√ÉO USE getStaticPaths()!
// O Astro vai processar isso em tempo de execu√ß√£o

// Pega o slug da URL
const { slug } = Astro.params;
console.log(`üîç SSR: Processando p√°gina para slug: ${slug}`);

// Verifica se o slug existe
if (!slug) {
  console.log('‚ùå SSR: Slug n√£o encontrado, redirecionando...');
  return Astro.redirect('/servicos');
}

// Busca os dados do servi√ßo
let service: ServiceData | null = null;

try {
  console.log(`üì° SSR: Buscando dados para slug: ${slug}`);
  service = await getServiceBySlug(slug);
  console.log(`üìä SSR: Servi√ßo encontrado:`, service ? `${service.title}` : 'null');
} catch (error) {
  console.error('‚ùå SSR: Erro ao buscar servi√ßo:', error);
}

// Se n√£o encontrou o servi√ßo, redireciona
if (!service) {
  console.log(`‚ùå SSR: Servi√ßo n√£o encontrado para slug: ${slug}, redirecionando...`);
  return Astro.redirect('/servicos');
}

// Prepara links do WhatsApp
const currentUrl = Astro.url.href;
const whatsappLink = `https://wa.me/${service.whatsappNumber}?text=${encodeURIComponent(`Ol√°! Gostaria de agendar uma consulta para ${service.title}. Vi a oferta no site.`)}`;

console.log(`‚úÖ SSR: P√°gina carregada com sucesso para: ${service.title}`);
---

<MainLayout title={service.metaTitle} description={service.metaDescription}>
  <!-- Hero Section -->
  <section class="relative min-h-screen flex items-center justify-center overflow-hidden bg-gradient-to-br from-primary-dark via-primary-dark to-primary-gold/20">
    <!-- Background Image -->
    <div class="absolute inset-0 z-0">
      <Image
        src={service.heroImage}
        alt={service.heroTitle}
        width={1920}
        height={1080}
        class="w-full h-full object-cover opacity-20"
      />
      <div class="absolute inset-0 bg-gradient-to-r from-primary-dark/90 via-primary-dark/70 to-transparent"></div>
    </div>
    
    <!-- Floating Elements -->
    <div class="absolute top-20 right-20 w-32 h-32 bg-primary-gold/10 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute bottom-32 left-16 w-40 h-40 bg-white/5 rounded-full blur-2xl animate-pulse delay-1000"></div>
    
    <div class="container relative z-10 text-center lg:text-left">
      <div class="grid lg:grid-cols-2 gap-12 items-center">
        <!-- Content -->
        <div class="text-white">
          <!-- Badge de Oferta -->
          {service.heroDiscount && (
            <div class="inline-flex items-center bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-full mb-6 animate-bounce shadow-lg">
              <span class="mr-2">üî•</span>
              <span class="font-bold">{service.heroDiscount} - Oferta Limitada!</span>
            </div>
          )}
          
          <!-- T√≠tulo Principal -->
          <h1 class="font-cormorant text-5xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight">
            {service.heroTitle}
          </h1>
          
          <!-- Subt√≠tulo -->
          <p class="text-2xl md:text-3xl text-primary-gold font-light mb-6 leading-relaxed">
            {service.heroSubtitle}
          </p>
          
          <!-- Descri√ß√£o -->
          <p class="text-xl text-white/90 mb-8 leading-relaxed max-w-2xl">
            {service.heroDescription}
          </p>
          
          <!-- Pre√ßo -->
          {(service.heroPrice && service.heroPrice !== 'Consulte') && (
            <div class="flex items-center gap-4 mb-8">
              <div class="flex items-baseline gap-2">
                <span class="text-4xl md:text-5xl font-bold text-primary-gold">{service.heroPrice}</span>
                {service.heroOriginalPrice && (
                  <span class="text-xl text-white/60 line-through">{service.heroOriginalPrice}</span>
                )}
              </div>
              <div class="text-sm text-white/80">
                <p>üí≥ 12x sem juros</p>
                <p>üìû Consulta gratuita</p>
              </div>
            </div>
          )}
          
          <!-- CTAs -->
          <div class="flex flex-col sm:flex-row gap-4 mb-8">
            <a 
              href={whatsappLink}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center justify-center bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-4 rounded-full font-bold text-lg hover:from-green-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105 shadow-xl hover:shadow-2xl"
            >
              <span class="mr-3">üì±</span>
              {service.primaryCTA}
            </a>
            <button 
              id="scroll-to-form"
              class="inline-flex items-center justify-center bg-transparent border-2 border-primary-gold text-primary-gold px-8 py-4 rounded-full font-bold text-lg hover:bg-primary-gold hover:text-primary-dark transition-all duration-300"
            >
              <span class="mr-3">üìù</span>
              Agendar Online
            </button>
          </div>
          
          <!-- Urg√™ncia -->
          <div class="flex items-center text-sm text-primary-gold">
            <span class="mr-2">‚è∞</span>
            <span>√öltimas vagas da semana! Agende hoje e garante o desconto.</span>
          </div>
        </div>
        
        <!-- Imagem/V√≠deo -->
        <div class="relative">
          <div class="relative rounded-3xl overflow-hidden shadow-2xl transform rotate-3 hover:rotate-0 transition-transform duration-500">
            <Image
              src={service.heroImage}
              alt={service.heroTitle}
              width={600}
              height={800}
              class="w-full h-auto object-cover"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-primary-dark/30 to-transparent"></div>
          </div>
          
          <!-- Badge Flutuante -->
          <div class="absolute -top-6 -right-6 bg-primary-gold text-primary-dark px-6 py-3 rounded-full font-bold shadow-xl">
            <div class="text-center">
              <div class="text-2xl font-black">4.9‚òÖ</div>
              <div class="text-xs">+500 clientes</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Scroll Indicator -->
    <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 text-white animate-bounce">
      <div class="flex flex-col items-center">
        <span class="text-sm mb-2">Deslize para saber mais</span>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
        </svg>
      </div>
    </div>
  </section>

  <!-- Benefits Section -->
  {service.benefits && service.benefits.length > 0 && (
    <section class="py-20 bg-white relative overflow-hidden">
      <div class="absolute top-0 right-0 w-96 h-96 bg-primary-gold/5 rounded-full -mr-48 -mt-48"></div>
      
      <div class="container relative z-10">
        <div class="text-center mb-16">
          <h2 class="font-cormorant text-4xl md:text-5xl font-bold text-primary-dark mb-6">
            Por que escolher nosso <span class="text-primary-gold italic">{service.title}?</span>
          </h2>
          <p class="text-xl text-gray-600 max-w-3xl mx-auto">
            Conhe√ßa os benef√≠cios exclusivos que fazem a diferen√ßa
          </p>
        </div>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
          {service.benefits.map((benefit, index) => (
            <div class="text-center group hover:transform hover:scale-105 transition-all duration-300">
              <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-primary-gold to-yellow-400 rounded-full flex items-center justify-center text-3xl shadow-lg group-hover:shadow-xl">
                {benefit.icon}
              </div>
              <h3 class="font-bold text-xl text-primary-dark mb-3">{benefit.title}</h3>
              <p class="text-gray-600 leading-relaxed">{benefit.description}</p>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Process Section -->
  {service.process && service.process.length > 0 && (
    <section class="py-20 bg-light-bg relative overflow-hidden">
      <div class="container relative z-10">
        <div class="text-center mb-16">
          <h2 class="font-cormorant text-4xl md:text-5xl font-bold text-primary-dark mb-6">
            Como funciona o <span class="text-primary-gold italic">procedimento?</span>
          </h2>
          <p class="text-xl text-gray-600 max-w-3xl mx-auto">
            Processo simples e seguro em {service.process.length} passos
          </p>
        </div>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
          {service.process.map((step, index) => (
            <div class="relative">
              <!-- Connector Line -->
              {index < service.process.length - 1 && (
                <div class="hidden lg:block absolute top-10 left-full w-full h-0.5 bg-primary-gold/30 z-0"></div>
              )}
              
              <div class="relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-xl transition-all duration-300 text-center border-t-4 border-primary-gold">
                <!-- Step Number -->
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-12 h-12 bg-primary-gold text-white rounded-full flex items-center justify-center font-bold text-lg">
                  {step.step}
                </div>
                
                <!-- Icon -->
                <div class="text-4xl mb-4 mt-2">{step.icon}</div>
                
                <!-- Content -->
                <h3 class="font-bold text-lg text-primary-dark mb-3">{step.title}</h3>
                <p class="text-gray-600 text-sm leading-relaxed">{step.description}</p>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Before/After Section -->
  {service.beforeAfter && service.beforeAfter.length > 0 && (
    <section class="py-20 bg-primary-dark text-white relative overflow-hidden">
      <div class="absolute bottom-0 left-0 w-96 h-96 bg-primary-gold/10 rounded-full -ml-48 -mb-48"></div>
      
      <div class="container relative z-10">
        <div class="text-center mb-16">
          <h2 class="font-cormorant text-4xl md:text-5xl font-bold mb-6">
            Resultados <span class="text-primary-gold italic">Comprovados</span>
          </h2>
          <p class="text-xl text-white/80 max-w-3xl mx-auto">
            Veja a transforma√ß√£o real dos nossos clientes
          </p>
        </div>
        
        <div class="grid md:grid-cols-2 gap-12">
          {service.beforeAfter.map((comparison, index) => (
            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="text-center">
                  <p class="text-primary-gold font-bold mb-2">ANTES</p>
                  <div class="rounded-xl overflow-hidden">
                    <Image
                      src={comparison.before}
                      alt="Antes do tratamento"
                      width={300}
                      height={300}
                      class="w-full h-auto object-cover"
                    />
                  </div>
                </div>
                <div class="text-center">
                  <p class="text-primary-gold font-bold mb-2">DEPOIS</p>
                  <div class="rounded-xl overflow-hidden">
                    <Image
                      src={comparison.after}
                      alt="Depois do tratamento"
                      width={300}
                      height={300}
                      class="w-full h-auto object-cover"
                    />
                  </div>
                </div>
              </div>
              <p class="text-center text-white/90 text-sm">{comparison.description}</p>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Testimonials Section -->
  {service.testimonials && service.testimonials.length > 0 && (
    <section class="py-20 bg-white relative overflow-hidden">
      <div class="container relative z-10">
        <div class="text-center mb-16">
          <h2 class="font-cormorant text-4xl md:text-5xl font-bold text-primary-dark mb-6">
            O que dizem nossos <span class="text-primary-gold italic">clientes</span>
          </h2>
          <p class="text-xl text-gray-600">
            +500 clientes satisfeitos com resultados incr√≠veis
          </p>
        </div>
        
        <div class="grid md:grid-cols-3 gap-8">
          {service.testimonials.map((testimonial, index) => (
            <div class="bg-light-bg rounded-2xl p-8 relative hover:transform hover:scale-105 transition-all duration-300 shadow-lg">
              <!-- Quote Icon -->
              <div class="absolute -top-4 left-8 w-8 h-8 bg-primary-gold rounded-full flex items-center justify-center text-white font-bold">
                "
              </div>
              
              <!-- Rating -->
              <div class="flex mb-4">
                {Array.from({length: testimonial.rating}).map((_, i) => (
                  <span class="text-yellow-400 text-xl">‚òÖ</span>
                ))}
              </div>
              
              <!-- Text -->
              <p class="text-gray-700 mb-6 italic leading-relaxed">"{testimonial.text}"</p>
              
              <!-- Author -->
              <div class="flex items-center">
                <Image
                  src={testimonial.image}
                  alt={testimonial.name}
                  width={50}
                  height={50}
                  class="w-12 h-12 rounded-full object-cover mr-4"
                />
                <div>
                  <p class="font-bold text-primary-dark">{testimonial.name}</p>
                  <p class="text-sm text-gray-600">{testimonial.treatment}</p>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Details Section -->
  <section class="py-20 bg-light-bg">
    <div class="container">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
          <h2 class="font-cormorant text-4xl font-bold text-primary-dark mb-4">
            Informa√ß√µes <span class="text-primary-gold italic">T√©cnicas</span>
          </h2>
        </div>
        
        <div class="grid md:grid-cols-4 gap-6">
          <div class="text-center bg-white rounded-xl p-6 shadow-sm">
            <div class="text-3xl mb-3">‚è±Ô∏è</div>
            <h3 class="font-bold text-primary-dark mb-2">Dura√ß√£o</h3>
            <p class="text-gray-600">{service.details.duration}</p>
          </div>
          <div class="text-center bg-white rounded-xl p-6 shadow-sm">
            <div class="text-3xl mb-3">üéØ</div>
            <h3 class="font-bold text-primary-dark mb-2">Sess√µes</h3>
            <p class="text-gray-600">{service.details.sessions}</p>
          </div>
          <div class="text-center bg-white rounded-xl p-6 shadow-sm">
            <div class="text-3xl mb-3">‚ú®</div>
            <h3 class="font-bold text-primary-dark mb-2">Resultados</h3>
            <p class="text-gray-600">{service.details.results}</p>
          </div>
          <div class="text-center bg-white rounded-xl p-6 shadow-sm">
            <div class="text-3xl mb-3">üèÉ‚Äç‚ôÄÔ∏è</div>
            <h3 class="font-bold text-primary-dark mb-2">Recupera√ß√£o</h3>
            <p class="text-gray-600">{service.details.recovery}</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  {service.faq && service.faq.length > 0 && (
    <section class="py-20 bg-white">
      <div class="container">
        <div class="max-w-4xl mx-auto">
          <div class="text-center mb-16">
            <h2 class="font-cormorant text-4xl md:text-5xl font-bold text-primary-dark mb-6">
              D√∫vidas <span class="text-primary-gold italic">Frequentes</span>
            </h2>
            <p class="text-xl text-gray-600">
              Esclarecemos as principais quest√µes sobre o tratamento
            </p>
          </div>
          
          <div class="space-y-4">
            {service.faq.map((item, index) => (
              <div class="bg-light-bg rounded-xl overflow-hidden">
                <button 
                  class="w-full text-left p-6 font-bold text-primary-dark hover:bg-primary-gold/10 transition-colors duration-300 flex items-center justify-between faq-toggle"
                  data-target={`faq-${index}`}
                >
                  <span>{item.question}</span>
                  <svg class="w-5 h-5 transition-transform duration-300 faq-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </button>
                <div id={`faq-${index}`} class="hidden p-6 pt-0 text-gray-700 leading-relaxed faq-content">
                  {item.answer}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- CTA Form Section -->
  <section id="form-section" class="py-20 bg-gradient-to-br from-primary-dark to-primary-gold/20 text-white relative overflow-hidden">
    <div class="absolute top-0 right-0 w-96 h-96 bg-white/5 rounded-full -mr-48 -mt-48"></div>
    <div class="absolute bottom-0 left-0 w-96 h-96 bg-primary-gold/10 rounded-full -ml-48 -mb-48"></div>
    
    <div class="container relative z-10">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="font-cormorant text-4xl md:text-6xl font-bold mb-6">
          Agende sua <span class="text-primary-gold italic">Consulta</span>
        </h2>
        <p class="text-xl mb-4">
          ‚ú® Consulta de avalia√ß√£o GRATUITA
        </p>
        <p class="text-lg mb-12 text-white/90">
          Preencha o formul√°rio e nossa equipe entrar√° em contato em at√© 30 minutos
        </p>
        
        <div class="grid lg:grid-cols-2 gap-12 items-center">
          <!-- Form -->
          <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-8">
            <form class="space-y-6" action="#" method="POST" id="contact-form">
              <div>
                <input 
                  type="text" 
                  name="nome" 
                  placeholder="Seu nome completo"
                  required
                  class="w-full px-6 py-4 rounded-full bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:border-primary-gold focus:bg-white/30 transition-all duration-300"
                />
              </div>
              <div>
                <input 
                  type="tel" 
                  name="telefone" 
                  placeholder="Seu WhatsApp"
                  required
                  class="w-full px-6 py-4 rounded-full bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:border-primary-gold focus:bg-white/30 transition-all duration-300"
                />
              </div>
              <div>
                <input 
                  type="email" 
                  name="email" 
                  placeholder="Seu melhor e-mail"
                  required
                  class="w-full px-6 py-4 rounded-full bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:border-primary-gold focus:bg-white/30 transition-all duration-300"
                />
              </div>
              <div>
                <select 
                  name="periodo" 
                  required
                  class="w-full px-6 py-4 rounded-full bg-white/20 border border-white/30 text-white focus:outline-none focus:border-primary-gold focus:bg-white/30 transition-all duration-300"
                >
                  <option value="">Melhor per√≠odo para contato</option>
                  <option value="manha">Manh√£ (9h √†s 12h)</option>
                  <option value="tarde">Tarde (12h √†s 18h)</option>
                  <option value="noite">Noite (18h √†s 20h)</option>
                </select>
              </div>
              <button 
                type="submit"
                class="w-full bg-gradient-to-r from-primary-gold to-yellow-400 text-primary-dark px-8 py-4 rounded-full font-bold text-lg hover:from-yellow-400 hover:to-primary-gold transition-all duration-300 transform hover:scale-105 shadow-xl"
              >
                üéØ Agendar Consulta Gratuita
              </button>
            </form>
            
            <div class="mt-6 text-center">
              <p class="text-sm text-white/80 mb-4">Ou fale conosco direto no WhatsApp:</p>
              <a 
                href={whatsappLink}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center bg-green-500 text-white px-6 py-3 rounded-full font-bold hover:bg-green-600 transition-colors duration-300"
              >
                <span class="mr-2">üì±</span>
                Chamar no WhatsApp
              </a>
            </div>
          </div>
          
          <!-- Benefits -->
          <div class="space-y-6">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-primary-gold rounded-full flex items-center justify-center text-primary-dark font-bold flex-shrink-0">
                ‚úì
              </div>
              <div>
                <h3 class="font-bold text-xl mb-2">Consulta 100% Gratuita</h3>
                <p class="text-white/90">Avalia√ß√£o completa sem nenhum custo</p>
              </div>
            </div>
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-primary-gold rounded-full flex items-center justify-center text-primary-dark font-bold flex-shrink-0">
                ‚úì
              </div>
              <div>
                <h3 class="font-bold text-xl mb-2">Resposta em 30 Minutos</h3>
                <p class="text-white/90">Nossa equipe retorna rapidamente</p>
              </div>
            </div>
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-primary-gold rounded-full flex items-center justify-center text-primary-dark font-bold flex-shrink-0">
                ‚úì
              </div>
              <div>
                <h3 class="font-bold text-xl mb-2">Sem Compromisso</h3>
                <p class="text-white/90">Tire suas d√∫vidas sem press√£o</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Trust Signals -->
  <section class="py-12 bg-white border-t border-gray-100">
    <div class="container">
      <div class="flex flex-wrap justify-center items-center gap-8 text-center">
        <div class="flex items-center gap-3 text-gray-600">
          <span class="text-2xl">üè•</span>
          <span class="font-medium">Cl√≠nica Licenciada</span>
        </div>
        <div class="flex items-center gap-3 text-gray-600">
          <span class="text-2xl">üë®‚Äç‚öïÔ∏è</span>
          <span class="font-medium">M√©dicos Especialistas</span>
        </div>
        <div class="flex items-center gap-3 text-gray-600">
          <span class="text-2xl">üõ°Ô∏è</span>
          <span class="font-medium">100% Seguro</span>
        </div>
        <div class="flex items-center gap-3 text-gray-600">
          <span class="text-2xl">‚≠ê</span>
          <span class="font-medium">4.9/5 Avalia√ß√£o</span>
        </div>
        <div class="flex items-center gap-3 text-gray-600">
          <span class="text-2xl">üíØ</span>
          <span class="font-medium">+500 Clientes</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Debug Info (apenas em desenvolvimento) -->
  {import.meta.env.DEV && (
    <div class="bg-gray-100 p-4 text-sm text-gray-600">
      <h3 class="font-bold mb-2">üêõ Debug Info (Development Only):</h3>
      <p><strong>Slug:</strong> {slug}</p>
      <p><strong>Service Title:</strong> {service?.title}</p>
      <p><strong>Mode:</strong> SSR</p>
      <p><strong>Benefits Count:</strong> {service?.benefits?.length || 0}</p>
      <p><strong>Process Count:</strong> {service?.process?.length || 0}</p>
      <p><strong>FAQ Count:</strong> {service?.faq?.length || 0}</p>
      <p><strong>Testimonials Count:</strong> {service?.testimonials?.length || 0}</p>
      <p><strong>Before/After Count:</strong> {service?.beforeAfter?.length || 0}</p>
    </div>
  )}
</MainLayout>

<!-- Scripts TypeScript -->
<script>
  // TypeScript para os scripts do cliente
  interface FormData {
    get(key: string): FormDataEntryValue | null;
  }

  // Fun√ß√£o para inicializar a p√°gina
  function initializePage() {
    console.log('üéØ SSR: P√°gina carregada no cliente');
    
    // FAQ Toggle Functionality
    initializeFAQ();
    
    // Scroll to form functionality
    initializeScrollToForm();
    
    // Form submission handler
    initializeContactForm();
    
    // Smooth scroll para links internos
    initializeSmoothScroll();
  }

  // FAQ Toggle
  function initializeFAQ() {
    const faqToggles = document.querySelectorAll('.faq-toggle') as NodeListOf<HTMLButtonElement>;
    
    faqToggles.forEach(toggle => {
      toggle.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        if (!targetId) return;
        
        const faqContent = document.getElementById(targetId);
        const icon = this.querySelector('.faq-icon') as SVGElement;
        
        if (faqContent && icon) {
          if (faqContent.classList.contains('hidden')) {
            faqContent.classList.remove('hidden');
            icon.style.transform = 'rotate(180deg)';
          } else {
            faqContent.classList.add('hidden');
            icon.style.transform = 'rotate(0deg)';
          }
        }
      });
    });
  }

  // Scroll to form functionality
  function initializeScrollToForm() {
    const scrollToFormBtn = document.getElementById('scroll-to-form') as HTMLButtonElement;
    if (scrollToFormBtn) {
      scrollToFormBtn.addEventListener('click', function() {
        const formSection = document.getElementById('form-section');
        if (formSection) {
          formSection.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    }
  }

  // Form submission handler
  function initializeContactForm() {
    const contactForm = document.getElementById('contact-form') as HTMLFormElement;
    if (contactForm) {
      contactForm.addEventListener('submit', function(e: Event) {
        e.preventDefault();
        console.log('üìù Form submitted for service:', document.title);
        
        // Pega os dados do formul√°rio
        const formData = new FormData(this);
        const nome = formData.get('nome') as string;
        const telefone = formData.get('telefone') as string;
        const email = formData.get('email') as string;
        const periodo = formData.get('periodo') as string;
        
        // Valida√ß√£o b√°sica
        if (!nome || !telefone || !email || !periodo) {
          alert('Por favor, preencha todos os campos obrigat√≥rios.');
          return;
        }
        
        // Cria mensagem para WhatsApp
        const message = `Ol√°! Gostaria de agendar uma consulta:

üè• *Servi√ßo:* ${document.title}
üë§ *Nome:* ${nome}
üì± *Telefone:* ${telefone}
üìß *Email:* ${email}
‚è∞ *Melhor hor√°rio:* ${periodo}

Vi a p√°gina no site e gostaria de mais informa√ß√µes.`;

        // Pega o n√∫mero do WhatsApp do elemento na p√°gina ou usa fallback
        const whatsappLinks = document.querySelectorAll('a[href*="wa.me"]');
        let whatsappNumber = '62983265797'; // Fallback
        
        if (whatsappLinks.length > 0) {
          const firstLink = whatsappLinks[0] as HTMLAnchorElement;
          const urlMatch = firstLink.href.match(/wa\.me\/(\d+)/);
          if (urlMatch) {
            whatsappNumber = urlMatch[1];
          }
        }
        
        const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
        
        // Abre WhatsApp
        window.open(whatsappUrl, '_blank');
        
        // Analytics tracking (se dispon√≠vel)
        trackFormSubmission();
        
        // Feedback visual
        showFormSuccess();
      });
    }
  }

  // Smooth scroll para links internos
  function initializeSmoothScroll() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const href = this.getAttribute('href');
        if (href) {
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth'
            });
          }
        }
      });
    });
  }

  // Analytics tracking
  function trackFormSubmission() {
    // Google Analytics tracking (se dispon√≠vel)
    if (typeof gtag !== 'undefined') {
      gtag('event', 'form_submit', {
        event_category: 'engagement',
        event_label: 'contact_form',
        value: 1
      });
    }
    
    // Facebook Pixel tracking (se dispon√≠vel)
    if (typeof fbq !== 'undefined') {
      fbq('track', 'Lead', {
        content_name: document.title,
        content_category: 'Servi√ßos'
      });
    }
    
    console.log('üìä Analytics: Form submission tracked');
  }

  // Feedback visual de sucesso
  function showFormSuccess() {
    const form = document.getElementById('contact-form');
    if (form) {
      const originalHTML = form.innerHTML;
      
      form.innerHTML = `
        <div class="text-center py-8">
          <div class="text-6xl mb-4">‚úÖ</div>
          <h3 class="text-2xl font-bold text-white mb-4">Formul√°rio Enviado!</h3>
          <p class="text-white/90 mb-6">Voc√™ ser√° redirecionado para o WhatsApp para finalizar o agendamento.</p>
          <button onclick="location.reload()" class="bg-primary-gold text-primary-dark px-6 py-3 rounded-full font-bold hover:bg-yellow-400 transition-colors">
            Enviar Outro Formul√°rio
          </button>
        </div>
      `;
      
      // Volta ao normal ap√≥s 10 segundos
      setTimeout(() => {
        form.innerHTML = originalHTML;
        initializeContactForm(); // Re-inicializa o form
      }, 10000);
    }
  }

  // Lazy loading para imagens (opcional)
  function initializeLazyLoading() {
    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target as HTMLImageElement;
            if (img.dataset.src) {
              img.src = img.dataset.src;
              img.classList.remove('lazy');
              imageObserver.unobserve(img);
            }
          }
        });
      });

      document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
      });
    }
  }

  // Anima√ß√µes de entrada (opcional)
  function initializeAnimations() {
    if ('IntersectionObserver' in window) {
      const animationObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-in');
          }
        });
      }, {
        threshold: 0.1
      });

      document.querySelectorAll('.animate-on-scroll').forEach(el => {
        animationObserver.observe(el);
      });
    }
  }

  // Inicializa tudo quando o DOM estiver pronto
  document.addEventListener('DOMContentLoaded', function() {
    initializePage();
    initializeLazyLoading();
    initializeAnimations();
  });

  // Error handling global
  window.addEventListener('error', function(e) {
    console.error('üö® JavaScript Error:', e.error);
  });

  // Service Worker (opcional - para PWA)
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/sw.js')
        .then(function(registration) {
          console.log('üì± SW registered: ', registration);
        })
        .catch(function(registrationError) {
          console.log('‚ùå SW registration failed: ', registrationError);
        });
    });
  }
</script>

<!-- Schema.org Structured Data -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "MedicalProcedure",
    "name": service.title,
    "description": service.description,
    "provider": {
      "@type": "MedicalOrganization",
      "name": "Lumino Cl√≠nica",
      "url": "https://joqueianapolis.com.br",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "An√°polis",
        "addressRegion": "GO",
        "addressCountry": "BR"
      }
    },
    "offers": {
      "@type": "Offer",
      "price": service.heroPrice !== 'Consulte' ? service.heroPrice.replace(/[^\d,]/g, '').replace(',', '.') : "0",
      "priceCurrency": "BRL",
      "availability": "https://schema.org/InStock"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.9",
      "reviewCount": "500"
    }
  }
</script>

<!-- Facebook Pixel (descomente e adicione seu pixel ID) -->
<!-- 
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window,document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  
  fbq('init', 'YOUR_PIXEL_ID');
  fbq('track', 'PageView');
  fbq('track', 'ViewContent', {
    content_name: service.title,
    content_category: 'Servi√ßos',
    value: service.heroPrice !== 'Consulte' ? parseFloat(service.heroPrice.replace(/[^\d,]/g, '').replace(',', '.')) : 0,
    currency: 'BRL'
  });
</script>
-->

<!-- Google Analytics (descomente e adicione seu GA4 ID) -->
<!-- 
<script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_GA4_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'YOUR_GA4_ID');
  
  // Track service page view
  gtag('event', 'page_view', {
    page_title: service.metaTitle,
    page_location: window.location.href,
    content_group1: 'Servi√ßos',
    content_group2: service.title
  });
</script>
-->

<!-- Hotjar (opcional - para heatmaps) -->
<!-- 
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:YOUR_HOTJAR_ID,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
-->